--- 
kind: pipeline
name: "Helm Charts"
steps: 
  - 
    commands: 
      - "helm lint charts/*"
    image: "alpine/helm:3.2.4"
    name: "Helm Lint"
  -
    commands:
      - "ct lint-and-install --config ct.yaml --all"
    image: "quay.io/helmpack/chart-testing:v3.0.0-rc.1"
    name: "Chart Testing"
  - 
    commands: 
      - "mkdir -p ./public"
      - "cd public"
      - |-
          echo "User-Agent: *
          Disallow: /" > robots.txt
      - "echo \"<h1>PetriPod Charts</h1>\" > index.html"
      - "helm package ../charts/* --destination ."
      - "helm repo index --url https://petripod.github.io/Charts ."
    image: "alpine/helm:3.2.4"
    name: "Package Charts"
  - 
    image: plugins/gh-pages
    name: "Publish Charts"
    settings: 
      pages_directory: public/
      password: 
        from_secret: github_secret
      username: 
        from_secret: github_username
type: docker
